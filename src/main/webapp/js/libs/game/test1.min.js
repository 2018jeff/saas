function startAsteroids(c){ship=1;bullet=2;asteroid=3;var a=3;function e(m,o){for(var l=0;l<8;l++){c.addEntity(new b(m,o,c.random(0,Math.PI*2),c.random(-0.5,0.5)))}}function f(l){setTimeout(function(){window.location.href=unescape(window.location.pathname)},1000*l)}function k(o,m,l,p){this.type=asteroid;this.world=o;this.x=l||(c.random(0,c.width/2)+3*c.width/4);this.y=p||(c.random(0,c.height/2)+3*c.height/4);this.angle=c.random(0,Math.PI);this.radius=m||40;this.angleV=c.random(-0.1,0.1);this.xV=c.random(-0.5,0.5);this.yV=c.random(-0.5,0.5);this.points=[];this.randomPoint=function(){return c.random(-this.radius/2,this.radius/2)};for(i=0;i<Math.round(this.radius/5);i++){this.points.push([this.radius*Math.sin(i*Math.PI/Math.round(this.radius/10))+this.randomPoint(),this.radius*Math.cos(i*Math.PI/Math.round(this.radius/10))+this.randomPoint()])}this.poly=[];this.collisionPoly=function(){return this.poly};this.explode=function(){e(this.x,this.y);c.delEntity(this);if(this.radius<4){c.addEntity(new k(this.world,this.radius/2,this.x,this.y))}};this.update=function(){this.angle+=this.angleV;this.x=(this.x+this.xV+c.width)%c.width;this.y=(this.y+this.yV+c.height)%c.height;for(n=0;n<this.points.length;n++){this.poly[n]=[this.points[n][0]*Math.cos(this.angle)-this.points[n][1]*Math.sin(this.angle)+this.x,this.points[n][0]*Math.sin(this.angle)+this.points[n][1]*Math.cos(this.angle)+this.y]}};this.draw=function(q){q.strokeStyle="rgba(255, 255, 255, 1.0)";c.polygon(this.poly)}}function j(l){this.world=l;this.rate=c.random(0.5,1);this.size=Math.round(c.random(0,3));this.x=c.random(0,10000);this.y=c.random(0,10000);this.vx=c.random(-1,1);this.vy=c.random(-1,1);this.fs="rgba(255, 255, 255, "+this.rate+")";this.update=function(){this.x=(this.x+this.vx+c.width)%c.width;this.y=(this.y+this.vy+c.height)%c.height};this.getX=function(){return Math.round(this.x)};this.getY=function(){return Math.round(this.y)};if(this.size>1){this.draw=function(m){m.strokeStyle=this.fs;m.beginPath();m.arc(this.getX(),this.getY(),this.size,0,Math.PI*2,true);m.closePath();m.stroke()}}else{this.draw=function(r){r.fillStyle=this.fs;var q=this.getX()-0.5;var p=this.getY()-0.5;r.beginPath();r.rect(q,p,1,1);for(var o=0;o<2;o++){for(var m=0;m<2;m++){r.rect(q+(o*2-1)*2,p+(m*2-1)*2,1,1);r.rect(q+(o*2-1),p+(m*2-1),1,1)}}r.closePath();r.fill()}}}function g(l){this.type=ship;this.world=l;this.world.player=this;this.x=c.width/2;this.y=c.height/2;this.angle=0;this.speed=0;this.points=[[0,-13],[-7,7],[7,7]];this.poly=[];this.lastsmoke=null;this.keyHeld_37=this.keyDown_37=function(){this.angle-=0.1};this.keyHeld_39=this.keyDown_39=function(){this.angle+=0.1};this.keyDown_38=function(){this.speed=1};this.keyHeld_38=function(){if(this.speed<3){this.speed+=0.3}};this.keyDown_32=function(){c.addEntity(new b(this.x+12*Math.sin(this.angle),this.y-12*Math.cos(this.angle),this.angle,this.speed,true))};this.keyDown=function(m){};this.collisionPoly=function(){return this.poly};this.collided=function(m){if(m.type==asteroid){this.explode();m.explode();f(1)}};this.explode=function(){e(this.x,this.y);c.delEntity(this)};this.update=function(){if(this.speed>0.1){this.speed-=0.1}else{this.speed=0}this.x=(this.x+this.speed*Math.sin(this.angle)+c.width)%c.width;this.y=(this.y-this.speed*Math.cos(this.angle)+c.height)%c.height;for(n=0;n<this.points.length;n++){this.poly[n]=[this.points[n][0]*Math.cos(this.angle)-this.points[n][1]*Math.sin(this.angle)+this.x,this.points[n][0]*Math.sin(this.angle)+this.points[n][1]*Math.cos(this.angle)+this.y]}if(this.speed&&(!c.inEntities(this.lastsmoke)||c.distance([this.lastsmoke.x,this.lastsmoke.y],[this.x,this.y])>15)){this.lastsmoke=new h(this.x-9*Math.sin(this.angle),this.y+9*Math.cos(this.angle));c.addEntity(this.lastsmoke)}};this.draw=function(m){m.strokeStyle="rgba(255, 255, 255, 1.0)";c.polygon(this.poly)}}function b(l,q,p,o,m){this.type=bullet;this.angle=p;this.x=l;this.y=q;this.speed=o+3;this.age=0;if(m){this.collisionPoly=function(){return this.poly};this.collided=function(r){if(r.type==asteroid){a-=1;r.explode();c.delEntity(this);if(!a){f(3)}}}}this.update=function(){if(this.age++>40){c.delEntity(this)}this.x=(this.x+this.speed*Math.sin(this.angle)+c.width)%c.width;this.y=(this.y-this.speed*Math.cos(this.angle)+c.height)%c.height;this.poly=[[this.x,this.y],[this.x-5*Math.sin(this.angle),this.y+5*Math.cos(this.angle)]]};this.draw=function(r){r.strokeStyle="rgba(255, 255, 255, 1.0)";c.polygon(this.poly)}}function h(l,m){this.x=l;this.y=m;this.life=1;this.draw=function(o){o.strokeStyle="rgba(200, 200, 200, "+this.life+")";o.beginPath();o.arc(this.x,this.y,2,0,Math.PI*2,true);o.closePath();o.stroke()};this.update=function(){this.life-=0.08;if(this.life<0){c.delEntity(this);this.life=0.01}}}function d(){this.player=null;this.x=0;this.y=0;this.draw=function(){c.clear();c.background("rgba(100, 100, 100, 1.0)")}}w=new d();c.addEntity(w);c.addEntity(new g(w));for(n=0;n<a;n++){c.addEntity(new k(w))}for(n=0;n<10;n++){c.addEntity(new j(w))}};