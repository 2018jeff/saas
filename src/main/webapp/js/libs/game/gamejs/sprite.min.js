function Sprite(k,o,m,g){var n=0;var h="";var i=-1;var c=0;var r=this;var d=0;var p=null;var e=0;this.loaded=false;this.width=0;this.height=0;var g=g?g:1;for(var q in o){for(var l=0;l<o[q].length;l++){if(typeof(o[q][l][0])=="string"){n+=1;var j=new Image();j.src=o[q][l][0];o[q][l][0]=j;j.onload=function(){n-=1;if(n==0){r.width=parseInt(j.width);r.height=parseInt(j.height);r.loaded=true;if(m){m(r)}}}}}if(n==0){if(o[q].length&&o[q][0].length){r.width=o[q][0][0].width;r.height=o[q][0][0].height}r.loaded=true;if(m){m(r)}}}var b={left:function(a){return 0},right:function(a){return a.width*g},center:function(a){return a.width*g/2}};var s={top:function(a){return 0},bottom:function(a){return a.height*g},center:function(a){return a.height*g/2}};this.action=function(f,t,u){if(typeof(u)=="undefined"){p=null}else{p=u}h=f;d=o[f].length;if(t){i=o[f][0][1];c=0}else{c=c%o[f].length}r.update=r._update;r.draw=r._draw;r.aabb=r._aabb;return this};this.angle=function(f){e=f};this.get_action=function(){return h};this.get_frame=function(){return c};this.get_num_frames=function(){return d};this.set_frame=function(a){c=a};this.get_size=function(){return[this.width*g,this.height*g]};this._update=function(){i-=1;if(i<=0){if(p&&(c+1>=o[h].length)){p(h)}c=(c+1)%o[h].length;var a=o[h][c];i=a[1];this.width=a[0].width;this.height=a[0].height}};this._draw=function(t,f){var a=o[h][c][0];if(e){t.translate(f[0],f[1]);t.rotate(e);t.drawImage(a,-b[k[0]](a),-s[k[1]](a),g*this.width,g*this.height)}else{t.drawImage(a,f[0]-b[k[0]](a),f[1]-s[k[1]](a),g*this.width,g*this.height)}};this._aabb=function(f){var a=o[h][c][0];return[f[0]-b[k[0]](a),f[1]-s[k[1]](a),a.width*g,a.height*g]};this.update=function(){};this.draw=function(){};this.aabb=function(){return[0,0,0,0]};for(var q in o){this.action(q);break}}Sprite.preload=function(b,d,f){var a=b.length;var c=[];for(var e=0;e<b.length;e++){c[e]=new Image();c[e].onload=function(){a-=1;if(f){f(a)}if(a==0&&d){d()}};c[e].src=b[e]}};