function JSGameSoup(g,O){this.frameCount=0;this.framerate=O;this.pointerPosition=[0,0];this.pointerDown=false;if(typeof g=="string"){g=document.getElementById(g)}if(g.tagName.toLowerCase()=="canvas"){this.canvas=g}else{var B=g;g=document.createElement("canvas");g.style.width=g.width=(B.offsetWidth+1);g.style.height=g.height=(B.offsetHeight+1);B.innerHTML="";B.appendChild(g);this.canvas=g}if(typeof(G_vmlCanvasManager)!="undefined"){G_vmlCanvasManager.initElement(g);this.canvas.style.cursor="default"}if(this.canvas&&this.canvas.getContext){this.ctx=this.canvas.getContext("2d")}else{alert("You are on a platform that does not support Canvas.\nTry ExplorerCanvas or FlashCanvas, maybe?");this.width=0;this.height=0;this.random=this.nullfunc;this.addEntity=this.nullfunc;this.launch=this.nullfunc;return}var G=this;this.width=parseInt(this.canvas.width);this.height=parseInt(this.canvas.height);this.pageOffset=null;this.include=function(T,V){var V=V;var U=document.getElementsByTagName("head")[0];script=document.createElement("script");script.type="text/javascript";script.src=T;if(V){script.onload=function(){V(T)}}U.appendChild(script)};this.schedule=function(U,V){if(U>0){var T=this.frameCount+U;if(!(T in j)){j[T]=[]}j[T].push(V)}};var j={};this.nullfunc=function(){};this.clear=function E(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)};this.polygon=function l(U,T){this.ctx.save();this.ctx.beginPath();this.ctx.moveTo(U[0][0],U[0][1]);for(var V=0;V<U.length;V++){this.ctx.lineTo(U[V][0],U[V][1])}if(T){this.ctx.lineTo(U[0][0],U[0][1])}this.ctx.closePath();this.ctx.fill();this.ctx.stroke();this.ctx.restore()};this.background=function F(T){this.ctx.save();this.ctx.fillStyle=T;this.ctx.fillRect(0,0,this.width,this.height);this.ctx.restore()};this.random=function r(U,T){return Math.random()*(T-U)+U};this.distance=function n(U,T){return Math.sqrt(Math.pow(T[0]-U[0],2)+Math.pow(T[1]-U[1],2))};this.heldKeys={};this.attachEvent=function c(U){var T=this.canvas;if(U.indexOf("key")==0){T=document}if(T.addEventListener){T.addEventListener(U,this["on"+U],false)}else{if(T.attachEvent){T.attachEvent("on"+U,this["on"+U])}else{T["on"+U]=this["on"+U]}}};this.oncontextmenu=function A(T){G.cancelEvent(T);return false};this.attachEvent("contextmenu");this.cancelEvent=function H(T){if(T.stopPropagation){T.stopPropagation()}if(T.preventDefault){T.preventDefault()}T.cancelBubble=true};this.isTouchDevice=function q(){try{document.createEvent("TouchEvent");return true}catch(T){return false}};this._getCanvasPageOffset=function(){if(!G.pageOffset){var ab=window;var Z=document;var X=g.getBoundingClientRect();var W=Z.documentElement.clientTop||Z.body.clientTop||0;var Y=Z.documentElement.clientLeft||Z.body.clientLeft||0;var T=ab.pageYOffset||Z.documentElement.scrollTop;var V=ab.pageXOffset||Z.documentElement.scrollLeft;var aa=X.top+T-W;var U=X.left+V-Y;G.pageOffset={top:Math.round(aa),left:Math.round(U)}}return G.pageOffset};this.getSetPointerPosition=function(W){var V,U,X,T=this._getCanvasPageOffset();if(W.touches&&W.touches.length){X=W.touches[0];V=X.pageX-T.left;U=X.pageY-T.top}else{if(W.pageX===undefined){W.pageX=W.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;W.pageY=W.clientY+document.body.scrollTop+document.documentElement.scrollTop}V=W.pageX-T.left;U=W.pageY-T.top}this.pointerPosition=[V,U];return this.pointerPosition};this.ontouchstart=function K(T){var T=(T)?T:window.event;G.pointInEntitiesCall(G.getSetPointerPosition(T),"pointerDown",T.touches.length);G.cancelEvent(T);G.pointerDown=true;return false};this.attachEvent("touchstart");this.ontouchend=function t(T){var T=(T)?T:window.event;G.pointInEntitiesCall(G.getSetPointerPosition(T),"pointerUp",T.touches.length);G.cancelEvent(T);G.pointerDown=false;return false};this.attachEvent("touchend");this.onmove=function s(U,T){var U=(U)?U:window.event;G.pointInEntitiesCall(G.getSetPointerPosition(U),"pointerMove",T);G.cancelEvent(U);return false};this.ontouchmove=function D(T){G.onmove(T,T.touches.length)};this.attachEvent("touchmove");this.onmousedown=function z(T){var T=(T)?T:window.event;G.pointInEntitiesCall(G.getSetPointerPosition(T),"pointerDown",T.button);G.cancelEvent(T);G.pointerDown=true;return false};this.attachEvent("mousedown");this.onmouseup=function u(T){var T=(T)?T:window.event;G.pointInEntitiesCall(G.getSetPointerPosition(T),"pointerUp",T.button);G.cancelEvent(T);G.pointerDown=false;return false};this.attachEvent("mouseup");this.onmousemove=function L(T){G.onmove(T,T.button)};this.attachEvent("mousemove");this.onkeydown=function m(T){var T=(T)?T:window.event;if(!G.heldKeys[T.keyCode]){G.entitiesCall("keyDown",T.keyCode);G.entitiesCall("keyDown_"+T.keyCode);G.heldKeys[T.keyCode]=true}G.cancelEvent(T);return false};this.attachEvent("keydown");this.onkeyup=function N(T){var T=(T)?T:window.event;if(G.heldKeys[T.keyCode]){G.entitiesCall("keyUp",T.keyCode);G.entitiesCall("keyUp_"+T.keyCode);G.heldKeys[T.keyCode]=false}G.cancelEvent(T);return false};this.attachEvent("keyup");var y=[];var M=[];var J=[];var a=0;var o=[];var P=[];var e=[];var f=[];this.addEntity=function i(T){M.push(T);return T};this.delEntity=function x(T){J.push(T);return T};this.inEntities=function I(T){return y.indexOf(T)>=0};this.clearEntities=function p(){for(var T=0;T<y.length;T++){J.push(y[T])}return y.length>0};this.getTriggeredEntities=function(){return P};this.addEntityToSpecialistLists=function w(T){for(var U in T){if(U.indexOf("keyHeld")==0&&e.indexOf(T)<0){e.push(T)}if(U.indexOf("collision")==0&&f.indexOf(T)<0){f.push(T)}}};this.removeEntityFromSpecialistLists=function C(T){e.remove(T);f.remove(T)};this.gameSoupLoop=function S(){if(this.frameCount in j){for(var U=0;U<j[this.frameCount].length;U++){j[this.frameCount][U](this)}delete j[this.frameCount]}for(var W=0;W<y.length;W++){if(y[W].update){y[W].update(this)}}var V=null;P=[];while(V=o.shift()){if(V[0][V[1]](V[2])){P.push(V[0])}}for(var W=0;W<M.length;W++){if(!M[W].priority){M[W].priority=0}M[W].priority_preference=a;a+=1;y.push(M[W]);this.addEntityToSpecialistLists(M[W]);if(M[W].init){M[W].init(this)}if(M[W].update){M[W].update(this)}}if(M.length){this.sortEntities()}M=[];for(var W=0;W<J.length;W++){y.remove(J[W]);this.removeEntityFromSpecialistLists(J[W])}J=[];for(var W=0;W<e.length;W++){var X=false;for(var T in this.heldKeys){if(this.heldKeys[T]){this.callAll(e,"keyHeld_"+T);X=true}}if(X){this.callAll(e,"keyHeld")}}this.clear();for(var W=0;W<y.length;W++){if(y[W].draw){this.ctx.save();y[W].draw(this.ctx,this);this.ctx.restore()}}this.frameCount+=1};this.launch=function b(){var U=this;if(navigator.userAgent.indexOf("MSIE")==-1){var T=setInterval(function(){try{U.gameSoupLoop()}catch(V){clearInterval(T);throw (V)}},1000/this.framerate)}else{var T=setInterval(function(){U.gameSoupLoop()},1000/this.framerate)}};this.sortEntities=function(){y.sort(function(U,T){return U.priority==T.priority?U.priority_preference-T.priority_preference:U.priority-T.priority})};this.pointInPoly=function v(V,U){cn=0;pts=U.slice();pts.push([U[0][0],U[0][1]]);for(var T=0;T<U.length;T++){if(((pts[T][1]<=V[1])&&(pts[T+1][1]>V[1]))||((pts[T][1]>V[1])&&(pts[T+1][1]<=V[1]))){if(V[0]<pts[T][0]+(V[1]-pts[T][1])/(pts[T+1][1]-pts[T][1])*(pts[T+1][0]-pts[T][0])){cn+=1}}}return cn%2};this.pointInBox=function R(U,T){return U[0]>=T[0]&&U[0]<=T[2]&&U[1]>=T[1]&&U[1]<=T[3]};this.pointInCircle=function k(U,T){return this.distance(U,T.slice(0,2))<=T[2]};this.pointInEntitiesCall=function Q(Y,U,T){var W=[];for(var X=0;X<y.length;X++){var V=y[X];if(V[U]){if((V.pointerPoly&&this.pointInPoly(Y,V.pointerPoly()))||(V.pointerBox&&this.pointInBox(Y,V.pointerBox()))||(V.pointerCircle&&this.pointInCircle(Y,V.pointerCircle()))||(V.pointerTest&&V.pointerTest(Y))){o.push([V,U,T]);W.push(V)}}}return W};this.entitiesCall=function d(U,T){this.callAll(y,U,T)};this.callAll=function h(U,V,T){for(var W=0;W<U.length;W++){if(U[W][V]){o.push([U[W],V,T])}}}}JSGameSoup.ready=function(a){JSGameSoup.ready_function=a};function _FindAndLaunchCanvasJSGS(){var e=document.getElementsByTagName("canvas");for(var b=0;b<e.length;b++){var c=null;var d=15;if(e[b].getAttribute){if(e[b].getAttribute("jsgs")){c=e[b].getAttribute("jsgs")}if(e[b].getAttribute("fps")){d=e[b].getAttribute("fps")}}else{if(e[b].jsgs){c=e[b].jsgs}if(e[b].fps){d=e[b].fps}}if(c){var a=new JSGameSoup(e[b],d);this[c](a);a.launch()}}}function _JSGS_test_applied_stylesheets(){var b=document.createElement("div");document.body.appendChild(b);b.style.position="absolute";b.style.width="100%";b.style.height="100%";var a=function(){if(parseInt(b.offsetWidth)==0){setTimeout(a,13)}else{document.body.removeChild(b);delete b;if(JSGameSoup.ready_function){JSGameSoup.ready_function()}_FindAndLaunchCanvasJSGS()}};a()}function _JSGS_init(){if(arguments.callee.done){return}arguments.callee.done=true;_JSGS_test_applied_stylesheets()}if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);_JSGS_init()},false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);_JSGS_init()}});if(document.documentElement.doScroll&&window==window.top){(function(){if(_JSGS_init.done){return}try{document.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}_JSGS_init()})()}}}_prevOnload=window.onload;window.onload=function(){if(typeof _prevOnload==="function"){_prevOnload()}_JSGS_init()};if(!Array.prototype.each){Array.prototype.each=function(c){var b=[];this.fn=c;for(var a=0;a<this.length;a++){b[a]=this.fn(this[a],a)}return b}}Number.prototype.mod=function(a){return((this%a)+a)%a};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length>>>0;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}if(!Array.prototype.remove){Array.prototype.remove=function(a){var b=this.indexOf(a);if(b>=0){this.splice(b,1)}}}function supportsToDataURL(){if(window.FlashCanvas){return true}else{var b=document.createElement("canvas");var a=b.toDataURL&&b.toDataURL("image/png");return(a&&a.indexOf("data:image/png")==0)}}if(!supportsToDataURL()){Number.prototype.toUInt=function(){return this<0?this+4294967296:this};Number.prototype.bytes32=function(){return[(this>>>24)&255,(this>>>16)&255,(this>>>8)&255,this&255]};Number.prototype.bytes16sw=function(){return[this&255,(this>>>8)&255]};Array.prototype.adler32=function(g,d){switch(arguments.length){case 0:g=0;case 1:d=this.length-g}var e=1,c=0;for(var f=0;f<d;f++){e=(e+this[g+f])%65521;c=(c+e)%65521}return((c<<16)|e).toUInt()};Array.prototype.crc32=function(h,a){switch(arguments.length){case 0:h=0;case 1:a=this.length-h}var e=arguments.callee.crctable;if(!e){e=[];var g;for(var f=0;f<256;f++){g=f;for(var b=0;b<8;b++){g=g&1?3988292384^(g>>>1):g>>>1}e[f]=g.toUInt()}arguments.callee.crctable=e}var g=4294967295;for(var d=0;d<a;d++){g=e[(g^this[h+d])&255]^(g>>>8)}return(g^4294967295).toUInt()};(function(){var b=function(){var c=Array.prototype.slice.call(this.getContext("2d").getImageData(0,0,this.width,this.height).data);var o=this.width;var l=this.height;var p=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82];Array.prototype.push.apply(p,o.bytes32());Array.prototype.push.apply(p,l.bytes32());p.push(8,6,0,0,0);Array.prototype.push.apply(p,p.crc32(12,17).bytes32());var m=l*(o*4+1);for(var n=0;n<l;n++){c.splice(n*(o*4+1),0,0)}var d=Math.ceil(m/32768);Array.prototype.push.apply(p,(m+5*d+6).bytes32());var j=p.length;var g=(m+5*d+6+4);p.push(73,68,65,84,120,1);for(var k=0;k<d;k++){var e=Math.min(32768,m-(k*32768));p.push(k==(d-1)?1:0);Array.prototype.push.apply(p,e.bytes16sw());Array.prototype.push.apply(p,(~e).bytes16sw());var f=c.slice(k*32768,k*32768+e);Array.prototype.push.apply(p,f)}Array.prototype.push.apply(p,c.adler32().bytes32());Array.prototype.push.apply(p,p.crc32(j,g).bytes32());p.push(0,0,0,0,73,69,78,68);Array.prototype.push.apply(p,p.crc32(p.length-4,4).bytes32());return"data:image/png;base64,"+btoa(p.map(function(h){return String.fromCharCode(h)}).join(""))};var a=HTMLCanvasElement.prototype.toDataURL;HTMLCanvasElement.prototype.toDataURL=function(d){var c=a.apply(this,arguments);if(c=="data:,"){HTMLCanvasElement.prototype.toDataURL=b;return this.toDataURL()}else{HTMLCanvasElement.prototype.toDataURL=a;return c}}})()}if(typeof(console)=="undefined"){var body=document.getElementsByTagName("body");if(body.length){function getDocHeight(){var a=document;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}var logarea=document.createElement("pre");logarea.style.width="100%";logarea.style.position="absolute";logarea.style.top=(getDocHeight()-100)+"px";logarea.style.height="50px";logarea.style.left="0px";logarea.style.filter="alpha(opacity=50)";logarea.style.opacity="0.5";logarea.style.margin="0";logarea.style.padding="0";logarea.style.overflow="hidden";logarea.style.textAlign="left";logarea.style.borderTop="1px solid black";logarea.style.display="none";body[0].appendChild(logarea);window.console={log:function(a){logarea.style.display="block";logarea.innerHTML+=a+"\r\n"}}}else{window.console={log:function(a){}}}};