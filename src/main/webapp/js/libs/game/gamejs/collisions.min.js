collide={};collide.collideall=function(c,b){var a="collide_"+b;return function(j,h){for(var e in j){for(var d in h){var f=j[e];var g=h[d];if(f!=g&&j.hasOwnProperty(e)&&h.hasOwnProperty(d)){var i=c(f,g);if(i){if(f[a]){f[a](g,i)}if(g[a]){g[a](f,i)}}}}}}};collide.aabb=function(){};collide.collide_aabb_entities=function(e,d){if(d.get_collision_aabb&&e.get_collision_aabb){var c=e.get_collision_aabb();var f=d.get_collision_aabb();return(!(c[0]>f[0]+f[2]||f[0]>c[0]+c[2]||c[1]>f[1]+f[3]||f[1]>c[1]+c[3]))}};collide.aabb=collide.collideall(collide.collide_aabb_entities,"aabb");collide.circles=function(){};collide.collide_circle_entities=function(f,d){if(d.get_collision_circle&&f.get_collision_circle){var e=f.get_collision_circle();var c=d.get_collision_circle();return Math.pow(e[0][0]-c[0][0],2)+Math.pow(e[0][1]-c[0][1],2)<Math.pow(e[1]+c[1],2)}};collide.circles=collide.collideall(collide.collide_circle_entities,"circle");var pointInPoly=function(c,b){cn=0;pts=b.slice();pts.push([b[0][0],b[0][1]]);for(var a=0;a<b.length;a++){if(((pts[a][1]<=c[1])&&(pts[a+1][1]>c[1]))||((pts[a][1]>c[1])&&(pts[a+1][1]<=c[1]))){if(c[0]<pts[a][0]+(c[1]-pts[a][1])/(pts[a+1][1]-pts[a][1])*(pts[a+1][0]-pts[a][0])){cn+=1}}}return cn%2};var lineOnLine=function(k,j){var r=k[0];var q=k[1];var e=j[0];var c=j[1];var o=r[0];var n=r[1];var b=q[0];var a=q[1];var f=e[0];var d=e[1];var i=c[0];var h=c[1];var p=(i-f)*(n-d)-(h-d)*(o-f);var g=(b-o)*(n-d)-(a-n)*(o-f);var s=(h-d)*(b-o)-(i-f)*(a-n);if(s){var m=p/s;var l=g/s;if(0<=m&&m<=1&&0<=l&&l<=1){return[o+m*(b-o),n+m*(a-n)]}else{return[]}}else{if(p==0||g==0){return[(b+o)/2,(a+n)/2]}else{return[]}}};collide.polys=function(){};collide.collide_poly_entities=function(k,j){if(j.get_collision_poly&&k.get_collision_poly){var i=k.get_collision_poly();var g=j.get_collision_poly();for(var f=0;f<i.length;f++){for(var e=0;e<g.length;e++){var d=[i[f],i[(f+1)%i.length]];var c=[g[e],g[(e+1)%g.length]];var h=lineOnLine(d,c);if(h.length){return[d,c,h]}}}return pointInPoly(i[0],g)||pointInPoly(g[0],i)}};collide.polys=collide.collideall(collide.collide_poly_entities,"poly");